{% extends 'layout/base.html' %}

{% block title %}Liste des Avoirs{% endblock %}
{% block extra_css %}
<!-- Add this to your head section -->
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
{% endblock %}

{% block content %}
<style>
    .pagination {
        margin-top: 20px;
        text-align: center;
    }

    .pagination-inner {
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 5px;
    }

    .pagination-link {
        color: #333;
        text-decoration: none;
        padding: 5px 10px;
        margin: 0 2px;
        border-radius: 3px;
    }

    .current-page {
        background-color: #007bff;
        color: #fff;
        padding: 5px 10px;
        margin: 0 2px;
        border-radius: 3px;
    }
</style>

<div class="container mt-4">
    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="liste-credits-tab" data-toggle="tab" href="#liste-credits" role="tab"
                aria-controls="liste-credits" aria-selected="true">LISTE DES CREDITS</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="credit-periode-tab" data-toggle="tab" href="#credit-periode" role="tab"
                aria-controls="credit-periode" aria-selected="false">CREDIT PERIODE</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="consomation-periode-tab" data-toggle="tab" href="#consomation-periode" role="tab"
                aria-controls="consomation-periode" aria-selected="false">ETAT</a>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="liste-credits" role="tabpanel" aria-labelledby="liste-credits-tab">
            <h1 class="text-center mb-4">LISTE DES CREDITS</h1>
            <table class="table table-striped">
                <!-- Insérer le contenu de la liste des crédits ici -->
                <thead style="background-color: #007BFF; color: #FFFFFF;">
                    <tr>
                        <th scope="col">CLIENT</th>
                        <th scope="col">MONTANT</th>
                        <th scope="col">DATE CREATION</th>
                        <th scope="col">CREATEUR</th>
                        <th scope="col">FACTURE</th>
                    </tr>
                </thead>
                <tbody>
                    {% for avoir in avoirs %}
                    <tr>
                        <td>{{ avoir.client.nom|upper }}-{{avoir.client.prenom|upper}}</td>
                        <td>{{ avoir.montant }}</td>
                        <td>{{ avoir.date_ajout |date:"d-m-Y" }}</td>
                        <td>{{ avoir.user }}</td>
                        <td>
                            {% if avoir.facture %}
                            <a href="{{ avoir.facture.url }}" target="_blank">Voir la facture</a>
                            {% else %}
                            N/A
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <!-- Pagination -->
            <div class="pagination">
                <div class="pagination-inner">
                    {% if avoirs.has_previous %}
                    <a class="pagination-link" href="?page=1">&laquo; First</a>
                    <a class="pagination-link" href="?page={{ avoirs.previous_page_number }}">Previous</a>
                    {% endif %}

                    {% for num in avoirs.paginator.page_range %}
                    {% if num == avoirs.number %}
                    <span class="current-page">{{ num }}</span>
                    {% else %}
                    <a class="pagination-link" href="?page={{ num }}">{{ num }}</a>
                    {% endif %}
                    {% endfor %}

                    {% if avoirs.has_next %}
                    <a class="pagination-link" href="?page={{ avoirs.next_page_number }}">Next</a>
                    <a class="pagination-link" href="?page={{ avoirs.paginator.num_pages }}">Last &raquo;</a>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="credit-periode" role="tabpanel" aria-labelledby="credit-periode-tab">
            <!-- Formulaire de recherche -->
            <form id="searchForm" class="mb-4" method="post" action="{% url 'compte_rendu' %}">
                {% csrf_token %}
                <div class="form-row">
                    <!-- Sélection Consommation ou Avoir -->
                    <div class="form-group col-md-6">
                        <label for="type">Type de recherche :</label>
                        <select class="form-control" id="type" name="type">
                            <option value="consommation">Consommation</option>
                            <option value="avoir">Avoir</option>
                        </select>
                    </div>
                    <!-- Sélection de la famille -->
                    <div class="form-group col-md-6">
                        <label for="famille">Famille :</label>
                        <select class="form-control" id="famille" name="famille">
                            <option value="famille1">Famille 1</option>
                            <option value="famille2">Famille 2</option>
                            <option value="famille3">Famille 3</option>
                        </select>
                    </div>
                </div>
                <!-- Champs de sélection de la période -->
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="startDate" class="sr-only">Date de début :</label>
                        <div class="input-group date" data-provide="datepicker">
                            <input type="text" class="form-control" id="startDate" name="startDate" placeholder="Date de début" required>
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="endDate" class="sr-only">Date de fin :</label>
                        <div class="input-group date" data-provide="datepicker">
                            <input type="text" class="form-control" id="endDate" name="endDate" placeholder="Date de fin" required>
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-primary" id="submitSearchFormBtn">Rechercher</button>
            </form>
        </div>
        
        <div class="tab-pane fade" id="consomation-periode" role="tabpanel" aria-labelledby="consomation-periode-tab">


            <!-- Tableau pour afficher la liste des consommations entre les deux dates -->
            <div class="row">
                <div class="col-md-6">
                    <h2 class="text-center mb-4">ETAT CREDIT</h2>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">MOIS</th>
                                    <th scope="col">NB. CREDITS</th>

                                    <th scope="col">FACTURE</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in data %}
                                <tr>
                                    <td>{{ item.annee }}/{{ item.mois }}</td>
                                    <td>{{ item.consommations |length }}</td>
                                    <td>

                                        <a href="#" class="text-primary"><i class="bi bi-download"></i></a>


                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="col-md-6">
                    <h2 class="text-center mb-4">ETAT CONSOMMATION</h2>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">MOIS</th>
                                    <th scope="col">NB. CREDIT</th>

                                    <th scope="col">FACTURE</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item2 in data2 %}
                                <tr>
                                    <td>{{ item2.annee }}/{{ item2.mois }}</td>
                                    <td>{{ item2.credits |length }}</td>
                                    <td>

                                        <a href="#" class="text-primary"><i class="bi bi-download"></i></a>


                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>

    </div>
</div>
{% endblock %}
{% block extra_js %}
<!-- Add this to your head section -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script>
    $(document).ready(function () {
        // Initialize datepicker
        $('.date').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true
        });

        // Use the submit event on the form
        $('#searchForm').on('submit', function (e) {
            e.preventDefault(); // Prevent the default form submission

            var startDate = $('#startDate').val();
            var endDate = $('#endDate').val();

            // Manually submit the form
            this.submit();
        });
    });




    document.getElementById('submitSearchFormBtn').addEventListener('click', function() {
        // Validation des champs
        var type = document.getElementById('type').value;
        var famille = document.getElementById('famille').value;
        var startDate = document.getElementById('startDate').value;
        var endDate = document.getElementById('endDate').value;

        // Vous pouvez ajouter des conditions de validation ici selon vos besoins

        // Soumission du formulaire asynchrone
        var formData = {
            type: type,
            famille: famille,
            startDate: startDate,
            endDate: endDate
        };

        console.log(formData)
    });

</script>
{% endblock %}